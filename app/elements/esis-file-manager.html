<dom-module id="esis-file-manager">
    <style>
        .page-header {
            border-bottom: 1px solid #ebebeb;
        }
    </style>

    <template>
        <div id="add">
            <input style="display:none;" id="fileDialog" type="file" on-change="onSelect" />
            <a class="btn btn-primary" on-click="chooseFile"><i class="fa fa-plus"></i> Add File</a>
        </div>
        <div id="importingLabel" style="display:none">
            <i class="fa fa-spinner fa-spin"></i> Importing...
        </div>

        <h4 class="page-header">Manage</h4>
        <div id="files"></div>
    </template>
</dom-module>

<script src="../scripts/elements/FileManager.js"></script>
<script>
    Polymer({
        is: 'esis-file-manager',

        mixins : [FileManager],

        configure : function() {
            return {
                currentFile : {},
                files : []
            }
        },

        chooseFile : function() {
            this.$.fileDialog.click();
        },

        onSelect : function(e) {
            this.select(this.$.fileDialog.value);
        },

        redrawFiles : function() {
            var panel = '';
            for( var i = 0; i < this.files.length; i++ ) {
                panel += '<div><h5>'+this.files[i].name+'</h5><div><table class="table">';


                for( var j = 0; j < this.files[i].tables.length; j++ ) {
                    panel += '<tr><td>Sheet '+j+'</td>'+
                            '<td>'+this.createFormatSelector(i, j,this.files[i].formats[j].type)+'</td>'+
                            '<td>'+this.createOrientationSelector(i, j, this.files[i].formats[j].orientation)+'</td>'+
                            '<td></td></tr>';
                }
                panel += '</table></div>'
            }
            panel += '</div>'
            this.$.files.innerHTML = panel;
        },

        setImporting : function(importing) {
            if( importing ) {
                $(this.$.add).hide();
                $(this.$.importingLabel).show();
            } else {
                $(this.$.add).show();
                $(this.$.importingLabel).hide();
            }
        },

        createFormatSelector : function(file, table, value) {
            return '<select id="'+file+'-'+table+'" class="format-selector">'+
                    '<option value="data" '+(value == 'data' ? 'selected' : '')+'>Data</option>'+
                    '<option value="metadata" '+(value == 'metadata' ? 'selected' : '')+'>Metadata</option>'+
                '</select>';
        },

        createOrientationSelector : function(file, table, value) {
            return '<select id="'+file+'-'+table+'" class="format-selector">'+
                    '<option value="row" '+(value == 'row' ? 'selected' : '')+'>Row</option>'+
                    '<option value="col" '+(value == 'col' ? 'selected' : '')+'>Column</option>'+
                '</select>';
        }


    });
</script>