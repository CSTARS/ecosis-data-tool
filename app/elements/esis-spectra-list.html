<dom-module id="esis-spectra-list">
    <style>
        :host {
            display: block;
            padding: 15px 5px;
        }
    </style>
    <template>

        <div>
            <a class="btn btn-primary" on-click="openFileManager">Open File Manager</a>
            <div class="help-text">Add / Remove spectra and metadata files</div>
        </div>

        <div id="spectra">
            <h4 class="page-header">Spectra</h4>
            <div id="tableRoot"></div>
        </div>

    </template>
</dom-module>

<script>
    Polymer({
        is : 'esis-spectra-list',

        ready : function() {
            this.popup = document.querySelector('esis-popup');
            this.popup.addEventListener('data-update', this.redrawTable.bind(this));
        },

        openFileManager : function() {
            this.popup.show();
        },

        redrawTable : function(e) {
            var files = e.detail;
            debugger;

            var table = '<table class="table">'+
                '<tr><th>File</th><th>Spectra</th><th>Attributes</th><th>Score</th><th>Data</th><th></th></tr>';

            for( var i = 0; i < files.length; i++ ) {
                var name = files[i].name.replace(/.*\//,'');


                for( var j = 0; j < files[i].spectra.length; j++ ) {
                    table += '<tr id="'+i+'-'+j+'"><td>'+name+'</td>'+
                             '<td>#'+j+'</td>'+
                             '<td>'+(Object.keys(files[i].spectra[j]).length-1)+'</td>'+
                             '<td><label class="label label-danger">0/0</label></td>'+
                             '<td>'+files[i].spectra[j].datapoints.length+'</td>'+
                             '<td><i class="fa fa-edit"></i></td></tr>';
                }
            }

            this.$.tableRoot.innerHTML = table+'</table>'
        }
    })
</script>